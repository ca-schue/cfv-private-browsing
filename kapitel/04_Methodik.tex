\chapter{Methodik}
\label{chapter:methodik}
In der Browserforensik ist eine definierte Methodik notwendig, um die Komplexität moderner Browser zu bewältigen. Sie bildet bildet eine wissenschaftliche Basis für den durchgeführten Versuch sowie einen Leitfaden für Ermittler bei zukünftigen Untersuchungen. \cite{Aggarwal.2010, Izzati.2022, Horsman.2019}	
Ein oft verwendetes Vorgehensmodell in der Computer Forensik ist das "Generic Model Computer Forensics Investigations", kurz GCFIM. \cite{Yusoff.2011}
%Ähnlich zum "abschnittsbasierter Verlauf einer forensischen Untersuchung" des Bundesamt für Sicherheit in der Informationstechnik ist es in Phasen mit definierten Abläufen gegliedert.
% https://www.bsi.bund.de/SharedDocs/Downloads/DE/BSI/Cyber-Sicherheit/Themen/Leitfaden_IT-Forensik.pdf?__blob=publicationFile&v=2

Izzati et al. haben diese Phasen auf Browserforensik abgebildet: \cite{Izzati.2022}
\begin{itemize}
	\item Vorbereitung: Versuchsplanung und Konfiguration der Versuchsumgebung.
	\item Datensammlung: Speicherabbilder identifizieren und während des Browsing Szenarios erstellen. 
	\item Datenanalyse: Suche nach Browsing Artefakten in gesammelten Daten.
	\item Dokumentation: Vorgehensweise und gefundene Artefakte dokumentieren.
\end{itemize}

Die Dokumentationsphase entspricht in dieser Arbeit dem Kapitel "Vergleich der Browser" (TODO!). Die Methodik der anderen Phasen wird nachfolgend beschrieben.

\section{Vorbereitung}
\label{section:methodik-vorbereitung}
In der Vorbereitungsphase wird der durchgeführte Versuch geplant sowie die Versuchsumgebung konfiguriert. \cite{Izzati.2022} Die Versuchsplanung umfasst die Auswahl von Browsern und Tools sowie die Definition der durchzuführenden Schritte zur Kontaminierung des Rechners. Die Konfiguration der Versuchsumgebung umfasst die Installation und Konfiguration der notwendigen Software und Hardware.

\subsection{Browserauswahl}
\label{section:methodik-vorbereitung-browserauswahl}
Für diese Arbeit dazu entschieden: zwei weit verbreitete Brower verwenden + zwei Browser mit verstärkem Schutz der Privatsphäre.

Dazu: Google Chrome und Mozilla Firefox ausgewählt.

Weiterhin werden zwei Browser mit verstärkem Schutz der Privatsphäre ausgewählt.
Basierend auf Chromium wird der Browser "Brave" gewählt.
Für Firefox wird der Tor-Browser gewählt, eine modifizierte Version von Firefox.

\subsubsection*{Firefox}
\label{subsubsection:methodik-vorbereitung-browserauswahl-firefox}
Der Browser Mozilla Firefox, kurz Firefox, ist ein open-source Webbrowser der gemeinnützigen Organisation Mozilla. 
*** TODO: Hier Verweis auf Literatur **
Firefox hat die Funktion des "privaten Modus". Diese ermöglicht es, ohne Speicherung von Verlaufsdaten und Cookies zu im Internet zu Browsen.
Laut Firefox wird mit dem privaten Modus vor dem "Lokalen Angreifer" geschützt, wie er in Kapitel X (TODO!) definiert ist, jedoch nicht vor dem Webangreifer.
Es wird ausdrücklich darauf hingewiesen, dass die besuchten Webseiten und Ihr Internetanbieter (ISP)  weiterhin anhand Ihrer IP-Adresse Informationen über die von Ihnen besuchten Seiten sammeln.
% https://www.mozilla.org/de/firefox/
% https://www.mozilla.org/de/about/history/

% Für diesen Versuch: Firefox Version 112.0.2 (64 Bit)

\subsubsection*{Tor}
\label{subsubsection:methodik-vorbereitung-browserauswahl-tor}
Der Tor Browser, ist ein auf Firefox basierender Webbrowser, der das Tor-Netzwerk nutzt.
Im Gegensatz zu Firefox wird hier mit Schutzmaßnahmen gegen den Webangreifer geworben.
Internetaktivitäten aufgrund des Tor-Netzwerks nicht verfolgt werden.
Der Tor Browser wirbt mit folgendem Schutzmaßnahmen gegen lokalen Angreifer:
- Tor Browser does not keep any browsing history. Cookies are only valid for a single Browsing session.
Zusätzliche Funktion: "Neue Identität"
\begin{figure}[h!]
	\resizebox{\linewidth}{!}{\includegraphics{bilder/tor-new-identity.png}}
%	\label{...}
	\caption{Tabelle mit wiederherstellbaren Dateien: Logfile 1 vs. Logfile 2}
\end{figure}
Die Funktion "Neue Identität" im Tor Browser ermöglicht es, alle aktuellen Tabs und Fenster zu schließen, sämtliche private Informationen wie Cookies und Verlauf zu löschen sowie die Verbindung mit dem Tor-Netzwerk neu zu konfigurieren.
%Für diesen Versuch: Tor Version 12.0.4 (64 Bit)

\subsubsection*{Chrome}
\label{subsubsection:methodik-vorbereitung-browserauswahl-chrome}

\subsubsection*{Brave}
\label{subsubsection:methodik-vorbereitung-browserauswahl-brave}

\subsection{Browsing Szenario}
\label{subsection:methodik-vorbereitung-browsing-szenario}
%*** TODO: Edge vorinstalliert erwähnen ***
% > Image als Hex: \cite{Ohana.2013}
Im Falle der Browser-Forensik werden eine Reihe von Aktivitäten definiert, die für jeden zu untersuchenden Browser durchgeführt werden, das sog. "Browsing Szenario".
Es wird somit definiert, mit welchen Daten der Rechner kontaminiert werden soll.

- Ziel: PB Artefakte, die ausschließlich in Browsing-Szenario vorkommen, bspw. "twitter" oder "facebook" bereits in vielen Windows-Standardanwendungen enthalten.

Folgende Schritte werden in jedem Browser durchgeführt: 

\begin{enumerate}
\item  www.google.com aufrufen
	\begin{enumerate}[label*=\arabic*.]
	\item Alle Cookies akzeptieren 
	\item Google-Suche nach "pfaffenhofen"
	\end{enumerate}
\item www.google.com aufrufen
	\begin{enumerate}[label*=\arabic*.]
	\item Cookies alle akzeptieren 
	\item Google-Suche nach "nanoradar" 
	\end{enumerate}
\item www.google.com aufrufen
	\begin{enumerate}[label*=\arabic*.]
	\item Cookies alle akzeptieren 
	\item Google-Suche nach "mallofamerica"
	\item Auf Suchergebnis "mallofamerica.com" klicken
	\end{enumerate}
\item www.google.com aufrufen
	\begin{enumerate}[label*=\arabic*.]
	\item Cookies alle akzeptieren 
	\item Google-Suche nach "mooserliesl"
	\item Auf Suchergebnis "mooserliesl.de" klicken
	\end{enumerate}
\item "www.unitree.com" über URL-Leiste öffnen
\item "www.donaukurier.de" über URL-Leiste öffnen
	\begin{enumerate}[label*=\arabic*.]
	\item Donaukurier Logo in neuem Tab öffnen
	\end{enumerate}
\item "mail.google.com" über URL-Leiste öffnen
	\begin{enumerate}[label*=\arabic*.]
	\item Mit google Account anmelden: 
			\begin{enumerate}[label*=\arabic*.]
			\item E-Mail = "computerforensikvl@gmail.com"
			\item Passwort = "Vorlesung23!"
			\end{enumerate}
	\item Neue E-Mail schreiben:
			\begin{enumerate}[label*=\arabic*.]
			\item Empfänger: "cas0597@thi.de" und "chs3702@thi.de"
			\item Betreff: "Betrefftext"
			\item Mailinhalt: "Mailinhalt"
			\end{enumerate}			
	\end{enumerate}
\end{enumerate}

Aus diesem Browsing-Szenario lassen sich die in Tabelle X dargestellten "private Browsing Artefakte", kurz PB Artefakte ableiten. Dabei handelt es sich dabei um Strings oder reguläre Ausdrücke, die eindeutig einem Schritt im Browsing-Szenario zugeordnet werden können. Diese sind von zentraler Bedeutung in der Analysephase: Nur nach diesen Strings wird gesucht.

\begin{table}[h!]
\centering
\begin{tabular}{|c|l|c|}
\hline
\textbf{Kategorie}           & \multicolumn{1}{c|}{\textbf{Private Browsing Artefakt}}                                      & \textbf{\begin{tabular}[c]{@{}c@{}}Schritt im\\  Browsing Szenario\end{tabular}} \\ \hline
\multirow{4}{*}{Suchbegriff} & "pfaffenhofen"                                                                               & 1.2                                                                              \\ \cline{2-3} 
                             & "nanoradar"                                                                                  & 2.2                                                                              \\ \cline{2-3} 
                             & "mallofamerica"                                                                              & 3.2                                                                              \\ \cline{2-3} 
                             & "mooserliesl"                                                                                & 4.2                                                                              \\ \hline
\multirow{4}{*}{URL}         & "mooserliesl.de"                                                                             & 3.3                                                                              \\ \cline{2-3} 
                             & "mallofamerica.com"                                                                          & 4.3                                                                              \\ \cline{2-3} 
                             & "unitree.com"                                                                                & 5.                                                                               \\ \cline{2-3} 
                             & "donaukurier.de"                                                                             & 6.                                                                               \\ \hline
Bild                         & \begin{tabular}[c]{@{}l@{}}0x89 0x50 0x4E 0x47 ...\\ (PNG als Hexadezimalwerte)\end{tabular} & 6.1                                                                              \\ \hline
\multirow{4}{*}{E-Mail}      & "computerforensikvl@gmail.com"                                                               & 7.1.1                                                                            \\ \cline{2-3} 
                             & "Vorlesung23!"                                                                               & 7.1.2                                                                            \\ \cline{2-3} 
                             & "cas0597@thi.de"                                                                             & 7.2.1                                                                            \\ \cline{2-3} 
                             & "chs3702@thi.de"                                                                             & 7.2.1                                                                            \\ \hline
\end{tabular}
\end{table}


\subsection*{VM Konfiguration}
\label{subsection:methodik-vorbereitung-vmkonfiguration}
Best Practice in Browser Forensik: Versuche sowie Analysen in virtualisierter Umgebung durchführen. (TODO: Quellen)
- Dadurch Reproduzierbarkeit der Ergebnisse sichergestellt
- Keine Vermischung der PB Artefakte, wenn gleicher Rechner zur Analyse verwendet
- Trennung der Versuchsumgebung von der Analyseumgebung
- Ergebnisse sind transportabel -> Zustände von Virtuellen Maschinen exportierbar

Als Virtualisierungssoftware für Versuch verwendet: Kostenlose Oracle VirtualBox VM.

Pro Browser wird eine VM erstellt, auf der Browsing Szenario durchgeführt wird. Alle VMs basieren auf gleicher OVA, deren Konfiguration in Tabelle X dargestellt ist.

Um Programme auf VM zu installieren: Gemeinsamer Order zwischen VM und Rechner eingerichtet, auf dem VM läuft. Ordner wird in VM als Netzwerklaufwerk angezeigt. Programme auf Analyserechner heruntergeladen, dann in VM offline installiert, um VM nicht vor Browsing-Szenario bereits mit Browsing Artefakten zu kontaminieren.

Auf VM zwei Werkzeuge der Sysinternal-Abteilung von Microsoft installiert, um in Analysephase Browserverhalten vollständig zu untersuchen: "Process Monitor", zur Aufzeichnung aller Prozessaktivitäten sowie "Process Explorer", um die Funktionen des Windows Task Managers zu erweitern. 
% https://learn.microsoft.com/de-de/sysinternals/downloads/procmon
% https://learn.microsoft.com/de-de/sysinternals/downloads/process-explorer

\begin{table}[h!]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Betriebssystem}         & Windows 10 Pro, 64 Bit, Build: 19045.2006                                  \\ \hline
\textbf{Festplatte}             & 30 GB, VDI-Format, kein SSD Laufwerk                                       \\ \hline
\textbf{RAM}                    & 6 GB                                                                       \\ \hline
\textbf{Netzwerk}               & Netzwerkbrücke                                                             \\ \hline
\textbf{Verbindung zu Host-PC}  & Gemeinsamer Ordner                                                         \\ \hline
\textbf{Installierte Programme} & \begin{tabular}[c]{@{}l@{}}Process Monitor (Version 3.93)\\ Process Explorer (Version 17.04)\end{tabular} \\ \hline
\end{tabular}
\end{table}

\subsubsection*{Browserinstallation}
Nachdem OVA mit Standardkonfiguration erstellt: Für jeden Browser dupliziert und Browser über gemeinsamen Ordner installiert. Folgende Installationsverzeichnisse verwendet:
\begin{enumerate}
\item[\textbf{Firefox}] \texttt{C:$\backslash$Program Files$\backslash$Mozilla Firefox$\backslash$firefox.exe}
\item[\textbf{Tor}] \texttt{C:$\backslash$Program Files$\backslash$Tor Browser$\backslash$Browser$\backslash$firefox.exe}
\item[\textbf{Chrome}] ***TODO!***
\item[\textbf{Brave}] ***TODO!***
\end{enumerate}

\subsection*{Verwendete Software}
\label{subsection:methodik-vorbereitung-verwendetesoftware}
Neben Konfiguration der VM muss Analyseumgebung vorbereitet werden.
Als Analyseumgebung dient der Rechner, auf dem die VM läuft.
Spezifikationen: *** TODO ***
Dazu: Diverse Tools zur Analyse installieren

\subsubsection*{Autopsy}
\label{subsubsection:methodik-vorbereitung-verwendetesoftware-autopsy}
Um erstellte Festplattenabbilder zu untersuchen: Tool "Autopsy" verwendet.
= Source-Digital-Forensik-Tool, das auf der Sleuthkit-Bibliothek basiert, diese mit zusätzlichen Funktionen erweitert und eine grafische Benutzeroberfläche für die forensische Analyse bietet.  
= Sammlung Befehlszeilen-Tools für die forensische Analyse von Dateisystemen. 
 
%Für diesen Versuch verwendet: Version 4.20.0

\subsubsection*{Volatility}
\label{subsubsection:methodik-vorbereitung-verwendetesoftware-volatility}
Um Abbilder des Arbeitsspeichers zu untersuchen: "Volatility"-Framework verwendet.
= Open-Source-Tool, das speziell darauf ausgerichtet ist, Informationen und Artefakte aus dem physischen oder virtuellen Arbeitsspeicher eines Computers zu extrahieren.
Geschrieben in Python, frei auf GitHub verfügbar:	
%Version: Volatility3, Version 2.4.1 (aktuellster Release)
Für diesen Versuch verwendet: "Volatility3"
= vollständige Neuschreibung des Volatility Memory Forensics Frameworks, wird seit 2020 entwickelt.
%Behebt technische und Performanceprobleme der vorherigen Version.
%Oft beworbender Vorteil von Volatility3: kein "Profile" mehr notwendig. Volatility3 erstellt Symboltabellen für Windows-Speicherabbilder basierend auf dem Speicherabbild selbst.
%Dabei handelt es sich um ein Konfigurationseinstellung, welche die Speicherstruktur und die Verhaltensweisen des Betriebssystems definiert.
	% https://volatility3.readthedocs.io/en/latest/vol2to3.html
	% https://www.volatilityfoundation.org/
	% https://github.com/volatilityfoundation/volatility3
Volatility basiert auf Plugins, welche spezifische Funktionen und Analysen für verschiedene Aspekte des Systems bereitstellen. Für diesen Versuch werden folgende Plugins verwendet. 
\begin{itemize}
\item pslist	
\item yarascan		
\item memmap	 	
\item filescan
\item svcscan
\end{itemize}
Genaue Beschreibung der PlugIns und deren Zusammenhang: Siehe Analysephase in Kapitel X (TODO!).

\subsubsection*{Sonstige Tools}
\label{subsubsection:methodik-vorbereitung-verwendetesoftware-sonstigetools}
Tabelle X listet zusammenfassend alle in diesem Versuch verwendeten Software-Programme, deren Zweck sowie Version auf.
Darunter diverse zusätzliche unterstützende Tools, welche zur vollständigen Analyse benötigt werden

\begin{table}[]
\resizebox{\linewidth}{!}{
\begin{tabular}{|l|l|l|}
\hline
\multicolumn{1}{|c|}{\textbf{Software}} & \multicolumn{1}{c|}{\textbf{Zweck}}                                              & \multicolumn{1}{c|}{\textbf{Version}} \\ \hline
Oracle VirtualBox                       & Virtualisierung                                                                  & 7.0.8 r156879                         \\ \hline
Windows 10 Pro                          & VM Betriebssystem                                                                & Build: 19045.2006                     \\ \hline
Process Monitor                         & Aufzeichnung Prozessaktivitäten                                                  & 3.93                                  \\ \hline
Process Explorer                        & Darstellung der Eigenschaften aktueller Prozesse                                 & 17.04                                 \\ \hline
Autopsy                                 & Analyse Festplattenabbilder                                                      & 4.20.0                                \\ \hline
Volatiltiy                              & Analyse RAM-Abbilder                                                             & Volatility3 Version 2.4.1             \\ \hline
HxD                                     & Analyse Binärdateien in hexadezimaler und ASCII-Darstellung                      & 2.5.0.0                               \\ \hline
Notepad++                               & Analyse strukturierter Dateiformate, z.B. JSON, XML                              & 8.4.5                                 \\ \hline
Registry Explorer                       & Grafischer Oberfläche zur Untersuchung von Windows-Registry Hives                & 2.0.0.0                               \\ \hline
DB Browser for SQLite                   & Grafische Oberfläche zur Verwaltung und Untersuchung von SQLite-Datenbanken      & 3.12.2                                \\ \hline
sqldiff.exe                             & Befehlszeilen-Programm zur Anzeige von Unterschieden zwischen SQLite-Datenbanken & 3.42.0                                \\ \hline
ChromeCacheView                         & Einlesen von Chrome Cache-Dateien und visuelle Aufbereitung des Inhalts          & 2.46                                  \\ \hline
MZCacheView                             & Einlesen von Firefox Cache-Dateien und visuelle Aufbereitung des Inhalts         & 2.21                                  \\ \hline
FirefoxCache2                           & Erweitert MZCacheView, um Firefox "index"-Cachedatei zu analysieren              & Commit b50ab4f                        \\ \hline
dejsonlz4                               & Dekomprimierung von .jsonlz4-Dateien                                             & Commit c4305b8                        \\ \hline
\end{tabular}
}
\end{table}


\section{Datensammlung}
\label{section:methodik-datensammlung}
In der Phase der Datensammlung werden alle potenziellen Beweismittel identifiziert und in einem analysierbaren Format gesichert.\cite{Izzati.2022}

Für diesen Versuch umfasst dies die Durchführung des Browsing Szenarios sowie die Sammlung von Ressoucen, die potentielle private Browsing Artefakte enthalten.

\subsection*{Process Monitor Logfiles}
\label{subsection:methodik-datensammlung-processmonitorlogfiles}
Um das Verhalten von privaten Browsingmodi möglichst vollständig zu untersuchen, schlagen Fayyad-Kazan et al. \cite{Fayyad.2021} vor, alle Aktivitäten des Browsers während Browsing-Szenarios aufzeichnen.
Dazu werden mit dem Tool "Process Monitor" alle Prozess-Aktivitäten zwischen zwei Zeitpunkten als "Process Monitor Logfile" (PML) oder CSV-Datei gespeichert. \cite{Fayyad.2021, Rochmadi.2017}
Die PML-Dateien werden mithilfe des gemeinsamen Ordners auf den Analyserechner transportiert.

\subsection*{Speicherabbilder}
\label{subsection:methodik-datensammlung-speicherabbilder}
Eine der Hauptaufgaben eines Computer-Forensischen-Ermittlers ist die Erstellung und Analyse von direkten Kopien der Speichermedien des untersuchten Rechners. \cite{Hassan.2019}
Im Falle der Browser Forensik werden Abbilder der Festplatten und des Arbeitsspeicher erstellt und analysiert.

\paragraph*{Festplatten-Image}
Da in diesem Versuch die Festplatten virtualisiert wurden, wird ein Abbild aus einem sogenannten "VM-Snapshot" gewonnen, eine Momentaufnahme der virtuellen Maschine.  % https://docs.oracle.com/en/virtualization/virtualbox/6.0/user/snapshots.html
VM-Snapshots können "aufgetaut" werden, wodurch der Zeitpunkt der Momentaufnahme des Betriebssystems wiederhergestellt wird.
Bei Oracle VirutalBox kann ein VM Snapshot über die grafische Oberfläche erstellt werden.
Durch den Snapshot wird ein "Virtual Disk Image", eine VDI-Datei, im Snapshot-Ordner der VM erzeugt. Diese Laufwerksdatei enthält nur differentielle Daten zum vorherigen Snapshot.
Um aus den differentiellen Daten ein vollständiges Festplatten-Image zu erzeugen muss ein "vollständiger Klon" des Snapshots erstellt werden. Die VDI-Datei der geklonten VM entspricht einem vollständigem Abbild der Festplatte zum Zeitpunkt des durchgeführten Snapshots.

Da Autopsy nicht das VDI-Format unterstützt, müssen die Laufwerksdateien der geklonten Snapshots in ein das generische Image-Format (.img) umgewandelt werden.
Durch Nutzung des VirtualBox Befehlszeilen-Tool "vboxmanage" wird mit dem Befehl \texttt{vboxmanage clonehd <VDI\_File>.vdi <IMG\_File>.img --format raw} die VDI-Datei ein eine IMG-Datei umgewandelt.

*** TODO: Hier Einlesen der Festplatten-Images => Zeitaufwändig! ***

\paragraph*{RAM-Dump}
Ein "RAM-Dump" erfasst den Zustand des Arbeitsspeichers, einschließlich der im Speicher befindlichen Daten, Programme und Prozesse zu einem bestimmten Zeitpunkt.
% https://kollee.github.io/posts/memory-forensics-of-a-virtualbox-vm/
VirtualBox empfiehlt, Abbilder des RAMs ebenfalls über das "vboxmanage" Befehlszeilen-Tool durchzuführen.
Im Unterschied zu Festplatten-Images können RAM-Dumps nur im angeschalteten Zustand der virtellen Maschine mithilfe des Befehls \texttt{vboxmanage debugvm <VM Name> dumpvmcore --filename "<RAM Dump Dateiname>.elf} durchgeführt werden. RAM-Dumps im .elf Format können direkt vom Analysetool Volatility eingelesen werden.		

\paragraph*{Zeitpunkte zur Datensammlung}
Wichtig für die Qualität der Versuchsergebnisse sind die Zeitpunkte während des Browsing Szenarios zum Sammeln der Daten.
Dieses Thema wird in der Literatur kaum thematisiert. Die Autoren wählen die Zeitpunkte meist ohne Begründung \cite{Sajan.2021, Nalawade.2016, Montasari.2015, Satvat.2014, Said.2011, Aggarwal.2010}.

Dieses Problem haben Muir, Leimich und Buchanan erkannt und Zeitpunkte zur Datensammlung vorgeschlagen, um das Browserverhalten während des Browsing-Szenarios vollständig analysieren zu können \cite{Muir.2019}. Wie in Abbildung X (TODO!) dargestellt, wurde sich an diesen Zeitpunkten für diesen Versuch orientiert.
\begin{figure}[h!]
	\centering
	\small
	\centerline{\resizebox{\linewidth}{!}{\input{bilder/datensammlung-zeitpunkte-Latex.pdf_tex}}}
	\caption{Datensammlung Zeitpunkte}
	\label{fig:jes}
\end{figure}
*** TODO: Kürzen ***
Nach der Browser-Installation, vor Beginn des Browsing-Szenarios wird der erste RAM-Dump sowie der erste VM-Snapshot erstellt.
Diese Speicherabbilder dienen als Benchmark für die Analyse, da in diesen Speicherabbildern kein PB Artefakt gefunden werden darf.

Nachdem der Private Modus im Browser geöffnet wird, bevor das Browsing Szenario beinnt wird die Aufnahme des ersten Process Monitor Logfiles gestartet.
Die Aufzeichnung beginnt erst zu diesem Zeitpunkt, da beim erstmaligem Öffnen der Browser einige Dateien initial angelegt werden. Um ausschließlich Schreiboperationen aufzuzeichnen, die auf das private Browsing zurückzuführen sind, wird die Aufzeichnung erst nach dem erstmaligen Öffnen des Browsers im privaten Modus gestartet.

Nach Durchführung des Browsing-Szenarios, während der Browser noch geöffnet ist, wird die Aufnahme des ersten Process Monitor Logfiles beendet. Weiterhin wird ein zweiter RAM-Dump sowie VM-Snapshot erstellt. Anschließend wird das eine zweite Process Monitor Aufzeichnung gestartet. 
Somit enthält das erste Logfile zu diesem Zeitpunkt die Prozessaktivitäten während des Browsing Szenarios. 

Nachdem der Browser geschlossen wurde, wird die Aufzeichnung des zweiten Process Monitor Logfiles beendet. Zusätzlich wird ein dritter RAM-Dump sowie  VM-Snapshot erstellt. Somit enthält das zweite Logfile wird alle Prozessaktivitäten vom Schließen der Browsers.

Nach Herunterfahren der VM wird ein vierter VM-Snapshot erstellt, der für die für Post-Mortem Analyse relevant ist.

\paragraph*{Sonderfälle}
Dieses Vorgehen zur Datensammlung wird bei allen Browsern durchgeführt. Einzig der Tor-Browser weicht davon ab. Um die "Neue Identität"-Funktion des Tor-Browsers zu berücksichten, werden zusätzlich Daten vor und nach der Erstellung einer "Neuen Identiät" gesammelt. Wie in Abbildung X (TODO!) dargestellt, umfasst dies einen zusätzlichen RAM-Dump sowie VM-Snapshot und ein weiteres Process Monitor Logfile.
\begin{figure}[h!]
	\centering
	\small
	\centerline{\resizebox{\linewidth}{!}{\input{bilder/datensammlung-zeitpunkte-tor-Latex.pdf_tex}}}
	\caption{Datensammlung Zeitpunkte Tor}
	\label{fig:jes}
\end{figure}	
Bei Durchführung des Browsing-Szenarios für den Firefox-Browser wurde nach erstmaligem Öffnen des Browsers automatisch die Firefox Datenschutz-Webseite \texttt{https://www.mozilla.org/de/privacy/firefox/} im nicht-privaten Modus geöffnet. 

\section{Datenanalyse}
\label{section:methodik-datenanalyse}
Nachdem Daten in Form von Process Monitor Logfiles und Festplatten- sowie RAM-Speicherabbildern gesammelt: in gesammelten Daten nach Strings in Tabelle X aus Kapitel X (TODO!) suchen. 

Um die Analyse zu vereinfachen: die gesammelten Daten des Versuchs lassen sich in drei Kategorien aufteilen:
> Common Locations
> Uncommon Locations	
> Registry

\subsection{Common Locations}
\label{subsection:methodik-datenanalyse-commonlocations}
*** TODO: Wichtig: NUR FESTPLATTE, NICHT RAM ***
Die sogenannten "Common Locations", (dt. "gängige Speicherorte") beziehen im Zusammenhang der Browserforensik auf die standardmäßigen Verzeichnisse eines Browsers, beispielsweise Ordner von Browsern zur Verwaltung von Nutzerdaten.
Untersucht werden Common Locations mittels "Whitebox-Analyse" \cite{Bonetti.2014}
Der Fokus liegt darauf, das System vollständig zu verstehen und alle relevanten Beweise zu sammeln.

Bei diesem Versuch werden die Browser Speicherorte über die Schreiboperationen der Process Monitor Logfiles identifiziert.
Anschließend wird für jede Datei in den Speicherorten geprüft, ob PB Artefakte enthalten sind.
Dazu sind zwei Schritte notwendig:
\begin{enumerate}
\item Dateiextraktion: Extrakion der Datei aus dem Speicherabbild. Wenn die Datei nicht mehr vorhanden ist, werden dazu ggf. Tools zur Dateiwiederherstellung benötigt.
\item Dateianalyse: Um zu überprüfen ob die Datei PB Artefakte enthält, werden ggf. Tools für spezielle Dateiformate benötigt, beispielsweise Dekomprimierungstools.
\end{enumerate}

\subsubsection*{Process Monitor Logfiles}
\label{subsubsection:methodik-datenanalyse-commonlocations-processmonitorlogfiles}
\paragraph*{Identifikation der Common Locations}
Um die gängigen Browserpfade und -dateien zu identifizieren, werden die in den Process Monitor Logfiles aufgezeichneten Schreibaktivitäten der Browserprozesse ausgewertet.

Dazu wird jede Process Logfile mit dem Process Explorer eingelesen. Anschließend werden die Aktivitäten gefiltert.
\begin{figure}[h!]
	\centerline{\resizebox{0.7\linewidth}{!}{\includegraphics{bilder/process-monitor-filter.png}}}
%	\label{...}
	\caption{Tabelle mit wiederherstellbaren Dateien: Logfile 1 vs. Logfile 2}
\end{figure}
Wie in Abbildung X dargestellt werden dazu ausschließlich die Option "File System Activity" ausgewählt.
Anschließend wird als Prozessname der Browserprozess gesetzt:
\begin{itemize}
\item[\textbf{Firefox}] firefox.exe
\item[\textbf{Tor-Browser}] firefox.exe und tor.exe
\item[\textbf{Chrome}] chrome.exe
\item[\textbf{Brave}] brave.exe
\end{itemize}
Da PB Artefakte nur über Schreiboperationen Operationen entstehen können, wird als Prozessoperation "WriteFile" gesetzt.
Die gefilterte Logfile wird als CSV exportiert, um sie dann in Excel zu öffnen und irrelevante Spalten sowie Duplikate zu löschen.
Die geschriebenen Dateien werden anschließend browserspezifisch gruppiert.

\paragraph*{Prüfung auf PB Artefakte}
Nachdem die geschriebenen Browserdateien identifiziert und kategorisiert wurden, wird für jede Datei geprüft, ob PB Artefakte enthalten sind. Folgende, in Abbildung X (TODO!) dargestellte Schritte sind zur Dateiextraktion und Dateianalyse notwendig:
Die Datei befindet sich entweder im entsprechenden Festplatten-Image oder ist im RAM-Dump gespeichert. 
Wenn die Datei nicht mit Autopsy aus dem Festplatten-Image extrahiert werden kann und sich der Dateiname in der Ausgabe des Volatiltiy Plugins "filescan" (\texttt{vol.py -f ram\_dump.img windows.filescan > filescan.txt}) befindet, wird diese mit dem Volatility Plugin "dumpfiles" aus dem RAM extrahiert.
Wenn auch dies nicht möglich ist und es sich um eine temporäre Datei (.tmp) handelt, wird versucht die enstprechende nicht-temporäre Datei zu extrahieren. 
Im Falle der Datei "some-file.json.tmp" wird beispielsweise geprüft, ob die Datei "some-file.json" existiert.
Nachdem die Datei extrahiert wurde und ggf. mit einem Tool zu Analyse vorberarbeitet wurde, wird geprüft, ob die Datei PB Artefakte enthält.
\begin{figure}[h!]
	\centering
	\small
	\centerline{\resizebox{\linewidth}{!}{\input{bilder/process_monitor_to_exce-Latexl.pdf_tex}}}
	\caption{TODO: Process Monitor Write Operation to Excel Spreadsheet}
	\label{fig:jes}
\end{figure}

\subsubsection*{SQLite-Datenbänke}
\label{subsubsection:methodik-datenanalyse-commonlocations-sqlitedbs}
Eine besondere Rolle unter den Common Locations bei Browsern nehmen SQLite Datenbänke ein. 
Sie ermöglichen Browsern das Speichern und Verwalten von Nutzerinformationen, wie Lesezeichen, Browserverlauf, Caches, Cookies in Datenbankdateien zu speichern, ohne einen separaten Datenbankserver zu benötigen.

Wie in Abbildung X dategestellt erfolgt die Dateiextraktion analog zur Vorgehensweise bei den Schreiboperationen der Process Monitor Logfiles.

Um die SQLite Datenbänke zu analysieren wird jede Datenbank mit der gleichen Datenbank aus dem vorherigem Snapshot mithilfe des Befehlszeilentools "sqldiff.exe" (\texttt{sqldiff.exe database1.sqlite database2.sqlite}) verglichen. Die Inhaltsunterschiede werden für jede Datei in jedem Snapshot untersucht und in einer Excel Tabelle festgehalten.
Datenbankänderungen einer SQLite-Datei werden zuerst im "Write-Ahead Log", kurz WAL, vorübergehend protokolliert. 
Um potentielle PB Artefakte zu berücksichtigen, wird der WAL mithilfe der sqlite3 Befehlszeile (\texttt{sqlite3> PRAGMA wal\_checkpoint;}) in die SQLite Hauptdatenbank geschrieben.

\begin{figure}[h!]
	\centering
	\small
	\centerline{\resizebox{\linewidth}{!}{\input{bilder/sqlite-methodology-Latex.pdf_tex}}}
	\caption{TODO: Process Monitor Write Operation to Excel Spreadsheet}
	\label{fig:jes}
\end{figure}

\subsection{Uncommon Locations}
\label{subsection:methodik-datenanalyse-uncommonlocations}
Ungewöhnliche Speicherorte beziehen sich auf Verzeichnisse, die nicht zu den gängigen Speicherorten gehören. 
Bei Festplatten-Images handelt es sich dabei meist um Dateien des Betriebssystems oder andere Festplattenbereiche, wie beispielsweise unallokierte Speicherbereiche oder der Arbeitsspeicher.
Uncommon Locations werden ohne Vorwissen über das Browserverhalten sowie ohne Vorverarbeitung der Dateien mithilfe der "Blackbox-Analyse" untersucht \cite{Bonetti.2014}:
Im Kontext der Browser Forensik werden dazu Stringsuchen nach PB Artefakten über die gesamten Speicherabbilder durchgeführt.
Dies ist nur durch Unterstützung mit Forensik-Tools möglich. Somit wird bei der Analyse der Uncommon Locations in die Vollständigkeit der Tools vertraut.

\subsubsection*{Analyse mit Autopsy}
\label{subsubsection:methodik-datenanalyse-uncommonlocations-analysemitautopsy}
Bei den Uncommon Locations wird Autopsy als forensisches Werkzeug zur Analyse der Festplatten-Images verwendet.
Dazu wird eine Stichwortsuche mit den in Tabelle X definierten PB Artefakten über das gesamte eingelesene Festplatten-Image durchgeführt.

Autopsy bietet dazu die in Abbildung X dargestellte Funktion an, zur Suche nach Strings, Teilstrings oder regulären Ausdrücken in Dateinamen und Dateiinhalten.
\begin{figure}[h!]
	\centerline{\resizebox{0.85\linewidth}{!}{\includegraphics{bilder/autopsy-search.png}}}
%	\label{...}
	\caption{Tabelle mit wiederherstellbaren Dateien: Logfile 1 vs. Logfile 2}
\end{figure}

Zusätzlich kategorisiert Autopsy automatisch die Dateien eines Festplatten-Images. Für diesen Versuch sind folgende Dateikategorien von Interesse:
\begin{itemize}
\item Web Bookmarks
\item Web Cookies
\item Web History
\item Web Categories
\end{itemize}


\subsubsection*{Analyse mit Volatility}
\label{subsubsection:methodik-datenanalyse-uncommonlocations-analysemitvolatility}
Bei der Analyse des Arbeitsspeichers als Uncommon Location ist es kritisch, dass ein gefundener String eindeutig einem Browserprozess zugeordnet werden kann. 

In der Literatur wird der Arbeitsspeicher oft unzureichend analysiert, indem eine Stringsuche im RAM-Dump durchgeführt ist, der als Binärdatei in einem Hexadezimaleditor geöffnet ist. \cite{Rochmadi.2017, Md.2018, Montasari.2015}
Wie beispielhaft in Abbildung X und Y gezeigt, wird ein String, der in einer Textdatei auf dem Desktop gespeichert ist ebenfalls im Hexadezimaleditor HxD angezeigt, obwohl kein Browsing Szenario durchgeführt wurde.
\begin{figure}[h!]
	\centerline{\resizebox{0.5\linewidth}{!}{\includegraphics{bilder/ram-editor1.png}}}
%	\label{...}
	\caption{Tabelle mit wiederherstellbaren Dateien: Logfile 1 vs. Logfile 2}
\end{figure}
\begin{figure}[h!]
	\resizebox{\linewidth}{!}{\includegraphics{bilder/ram-editor2.png}}
%	\label{...}
	\caption{Tabelle mit wiederherstellbaren Dateien: Logfile 1 vs. Logfile 2}
\end{figure}

Um einen im RAM gefundenen String einem Browserprozess zuordnen zu können, wird deshalb das forensiche Analysetool Volatility mit dem PlugIn "Yarascan" verwendet.

Mithilfe sogenannter "YARA-Regeln" wird bestimmten Mustern im Arbeitsspeicher gesucht.
Die für diesen Versuch verwendeten Yara-Regeln entsprechen den Strings der PB Artefakte in Tabelle X in Kapitel Y. Zusätzlich sucht eine Regel nach HTML-Fragmenten, die eindeutig einer besuchten Seite des Browsing-Szenarios zuzuordnen sind. \cite{Said.2011}
Alle verwendeten Yara-Regeln sind im Anhang X (TODO!) aufgelistet.

Um den RAM-Dump nach den Yara-Regeln zu durchsuchen wird folgender Befehl ausgeführt: \texttt{vol.py -f ram\_dump.img windows.vadyarascan --yara-file yara\_rules.yara > yarascan.txt}
Nachdem der RAM-Dump nach den Regeln durchsucht wurde, gibt die Yarascan-Ausgabe für jeden gefundenen String die PID des Prozesses, in dem der String gefunden wurde sowie die virtuelle Speicheradresse des gefundenen Strings an.

Wie in Abbildung X dargestellt, wird davon ausgehend mit dem Plugin "pslist" (\texttt{vol.py -f ram\_dump.img windows.pslist --pid <PID> > pslist.txt}) der Prozessname der PID ermittelt, in dem der String gefunden wurde.
\begin{figure}[h!]
	\centering
	\small
	\centerline{\resizebox{\linewidth}{!}{\input{bilder/yarascan_plugin_tree-Latex.pdf_tex}}}
	\caption{TODO: Process Monitor Write Operation to Excel Spreadsheet}
	\label{fig:jes}
\end{figure}

Oft ist für bei einem gefundenen String von Interesse, ob in den Speicheradressen vor und nach dem Treffer weitere Zusammenhänge erkennbar sind.
Mithilfe des Plugins "memmap" (\texttt{vol.py -f ram\_dump.img windows.memmap --pid <PID> > memmap.txt}) wird die Abbildung der virtuellen Speicheradressen eines Prozesses auf die Byte-Offset der extrahierten Speicherseite des Prozesses ermittelt.
Diese Seite kann mithilfe des "--dump" Flags extrahiert werden: \texttt{vol.py -f ram\_dump.img -o $\backslash$dump\_dir$\backslash$ windows.memmap --pid <PID> --dump}.
In einem Hexadezimaleditor, wie HxD, kann der String-Treffer anhand des ermittelten Byte-Offsets in der Speicherseite untersucht werden.

\subsection{Registry}
\label{subsection:methodik-datenanalyse-registry}
Die letzte Kategorie analysierter Daten umfasst die Artefakte der Registry.
Diese zählen sowohl zu den Common als auch Uncommon Locations und werden deshalb eigene Kategorie aufgeführt.

\paragraph*{Common Locations}
*** TODO: Common location: Shellactivities Key ***
	existiert nicht mehr --> Nicht mehr vorhanden in aktueller Version (Verweis auf E-Mail)

Als Teil der Common Locations werden die Registry-Aktivitäten in den Process Monitor Logfiles analysiert.
\begin{figure}[h!]
	\centerline{\resizebox{0.7\linewidth}{!}{\includegraphics{bilder/process-monitor-filter-registry.png}}}
%	\label{...}
	\caption{Tabelle mit wiederherstellbaren Dateien: Logfile 1 vs. Logfile 2}
\end{figure}
Wie in Abbildung X gezeigt, wird zunächst die Logfile ausschließlich nach "Registry Activity" sowie Einträgen mit der Operation "SetValue" sowie dem Browser-Prozessnamen gefiltert.
Als CSV Datei wird das Logfile in Excel weiter verarbeitet, indem Duplikate gelöscht werden und die geschriebenen Registry Keys browserspezifisch gruppiert werden.
	
\paragraph*{Uncommon Locations}
Als Uncommon Location werden alle Registry Hives in jedem Festplatten-Image mit dem "Registry Explorer" untersucht.
Dabei wird zwischen Hives zur Speicherung von Systemeinstellungen (System-Hives) und individuellen Benutzerkonfigurationen (User-Hives) unterschieden. Diese in Tabelle X dargestellten Hives werden von Windows beim Start geladen und dienen Systemkomponenten und Anwendungen als Quelle für Einstellungen und Informationen.	
 % https://medium.com/@haircutfish/tryhackme-windows-forensics-1-task-3-accessing-registry-hives-offline-task-4-data-acquisition-b440f5be2a13
Zur Analyse wird jeder Hive aus den Fesplatten-Images extrahiert und in eine Registry Explorer Sitzung geladen und eine Stringsuche nach PB Artefakten durchgeführt.

\begin{table}[h!]
\resizebox{\linewidth}{!}{
\begin{tabular}{lllll}
\cline{1-2}
\multicolumn{2}{|c|}{\textbf{System-Hives (C:\textbackslash{}\textbackslash{}Windows\textbackslash{}\textbackslash{}System32\textbackslash{}\textbackslash{}Config)}} &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textbf{Dateiname}}             & \multicolumn{1}{l|}{\textbf{Inhalt}}                                                                           &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textit{DEFAULT}}               & \multicolumn{1}{l|}{Standardkonfigurationseinstellungen für neue Benutzerprofile.}                             &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textit{SAM}}                   & \multicolumn{1}{l|}{Sicherheitskontensdaten, einschließlich der Benutzerkonten und deren Kennwörter.}          &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textit{SECURITY}}              & \multicolumn{1}{l|}{Sicherheitsinformationen für die Zugriffssteuerung und Authentifizierung.}                 &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textit{SOFTWARE}}              & \multicolumn{1}{l|}{Konfigurationsdaten für installierte Software und Anwendungen.}                            &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textit{SYSTEM}}                & \multicolumn{1}{l|}{Systemkonfigurationseinstellungen und Gerätetreiberinformationen.}                         &  &  &  \\ \cline{1-2}
                                                     &                                                                                                                &  &  &  \\ \cline{1-2}
\multicolumn{2}{|c|}{\textbf{User-Hives (C:\textbackslash{}\textbackslash{}Users\textbackslash{}\textbackslash{}\textless{}username\textgreater{})}}                  &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textbf{Dateiname}}             & \multicolumn{1}{l|}{\textbf{Inhalt}}                                                                           &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textit{NTUSER.DAT}}            & \multicolumn{1}{l|}{Individuelle Einstellungen und Konfigurationen für den angemeldeten Benutzer}              &  &  &  \\ \cline{1-2}
\multicolumn{1}{|l|}{\textit{USRCLASS.DAT}}          & \multicolumn{1}{l|}{Dateizuordnungen und Registrierungseinstellungen für den angemeldeten Benutzer}            &  &  &  \\ \cline{1-2}
\end{tabular}
}
\label{tab:windows-registry-hives}
\caption{Windows Registry Hives}
\end{table}
	

